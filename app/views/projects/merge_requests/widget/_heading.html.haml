- if @pipeline
  .mr-widget-heading
    - %w[success success_with_warnings skipped canceled failed running pending].each do |status|
      .ci_widget{ class: "ci-#{status}", style: ("display:none" unless @pipeline.status == status) }
        %span.status{ class: "ci-status-icon-#{status}" }= ci_icon_for_status(status)
        %span.pipeline-text
          Pipeline
          = link_to "##{@pipeline.id}", namespace_project_pipeline_path(@pipeline.project.namespace, @pipeline.project, @pipeline.id), class: 'pipeline'
          = ci_label_for_status(status)

        - stages = @pipeline.stages_with_latest_statuses
        - stages_status = @pipeline.statuses.latest.stages_status
        - stages.each do |stage|
          - status = stages_status[stage[0]]
          - hasMultipleBuilds = stage[1].count > 1
          - tooltip = "#{stage[0].titleize}: #{status || 'not found'}"
          - if status
            .stage-container.inline{ id: stage[0], class: "ci-status-icon-#{status} background-icon #{'dropdown grouped' if hasMultipleBuilds}" }
              .toggle{ class: "#{'has-tooltip' unless hasMultipleBuilds}", title: tooltip, data: { placement: 'top', toggle: "#{'dropdown' if hasMultipleBuilds}" } }
                = ci_icon_for_status(status, size: 24)
                - if hasMultipleBuilds
                  = icon('caret-down', class: 'dropdown-caret')
              - if hasMultipleBuilds
                .dropdown-menu.grouped-pipeline-dropdown
                  .arrow
                  %ul
                    - stage[1].each do |status|
                      %li
                        = render "projects/#{status.to_partial_path}_pipeline", subject: status

        - commit = @merge_request.diff_head_commit
        = succeed "." do
          = link_to @pipeline.short_sha, namespace_project_commit_path(@merge_request.source_project.namespace, @merge_request.source_project, @pipeline.sha), class: "monospace"
        %span.ci-coverage
- elsif @merge_request.has_ci?
  - # Compatibility with old CI integrations (ex jenkins) when you request status from CI server via AJAX
  - # Remove in later versions when services like Jenkins will set CI status via Commit status API
  .mr-widget-heading
    - %w[success skipped canceled failed running pending].each do |status|
      .ci_widget{class: "ci-#{status}", style: "display:none"}
        = ci_icon_for_status(status)
        %span
          CI build
          = ci_label_for_status(status)
        for
        - commit = @merge_request.diff_head_commit
        = succeed "." do
          = link_to commit.short_id, namespace_project_commit_path(@merge_request.source_project.namespace, @merge_request.source_project, commit), class: "monospace"
        %span.ci-coverage

    .ci_widget
      = icon("spinner spin")
      Checking CI status for #{@merge_request.diff_head_commit.short_id}&hellip;

    .ci_widget.ci-not_found{style: "display:none"}
      = icon("times-circle")
      Could not find CI status for #{@merge_request.diff_head_commit.short_id}.

    .ci_widget.ci-error{style: "display:none"}
      = icon("times-circle")
      Could not connect to the CI server. Please check your settings and try again.

.js-success-icon.hidden
  = ci_icon_for_status('success')
